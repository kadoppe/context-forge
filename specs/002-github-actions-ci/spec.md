# Feature Specification: GitHub Actions CI Setup

**Feature Branch**: `002-github-actions-ci`
**Created**: 2025-11-29
**Status**: Draft
**Input**: User description: "GitHub Actions でのCIをセットアップしたいです。ローカルで実施している ruff, mypy, テストの実行。その他プロジェクトの品質担保のためにやるべきことを、検証できるようにしたい。"

## Clarifications

### Session 2025-11-29

- Q: CIチェックの実行戦略は？ → A: 並列実行・全完了待機（各チェックが独立して並列実行、1つ失敗しても他は継続）
- Q: テスト対象Pythonバージョンは？ → A: Python 3.11のみ（将来的に3.12追加可能）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - コード品質の自動検証 (Priority: P1)

開発者として、プルリクエストを作成またはmainブランチにプッシュした際に、自動的にコード品質チェック（ruff, mypy, テスト）が実行され、問題があれば即座に通知を受けたい。

**Why this priority**: CIの最も基本的かつ重要な機能。品質問題を早期発見し、mainブランチの品質を保護することで、チーム全体の開発効率を向上させる。

**Independent Test**: プルリクエストを作成し、CIが自動実行されてチェック結果がGitHub上に表示されることを確認することで、単独でテスト可能。

**Acceptance Scenarios**:

1. **Given** 開発者がプルリクエストを作成した状態, **When** CIワークフローがトリガーされる, **Then** ruff、mypy、pytestの全チェックが自動実行される
2. **Given** CIチェックが実行中の状態, **When** すべてのチェックが完了する, **Then** 各チェックの結果（成功/失敗）がプルリクエストページに表示される
3. **Given** CIチェックでエラーが検出された状態, **When** 結果を確認する, **Then** どのチェックで何のエラーが発生したかが明確に分かる

---

### User Story 2 - PRマージ前のCI必須チェック (Priority: P2)

リポジトリ管理者として、CIチェックがすべて成功していないプルリクエストがmainブランチにマージされないようにしたい。

**Why this priority**: 品質ゲートとしての保護機能。CI自体が正常に動作することが前提となるため、P1の後に設定すべき。

**Independent Test**: CIが失敗している状態でマージボタンが無効化されていることを確認することでテスト可能。

**Acceptance Scenarios**:

1. **Given** CIチェックが失敗しているプルリクエストがある状態, **When** マージを試みる, **Then** マージがブロックされる（またはマージボタンが無効化される）
2. **Given** すべてのCIチェックが成功しているプルリクエストがある状態, **When** マージを試みる, **Then** マージが許可される

---

### Edge Cases

- CIの依存パッケージのインストールに失敗した場合、明確なエラーメッセージが表示される
- テストがタイムアウトした場合、タイムアウトであることが明確に通知される
- 同時に複数のプルリクエストがCIを実行している場合、それぞれ独立して実行される

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: ワークフローはプルリクエストの作成・更新時およびmainブランチへのプッシュ時に自動トリガーされなければならない
- **FR-002**: ワークフローはruffによるリンティングチェックを実行しなければならない
- **FR-003**: ワークフローはmypyによる型チェックを実行しなければならない
- **FR-004**: ワークフローはpytestによるテスト実行を行わなければならない
- **FR-005**: ワークフローはPython 3.11でチェックを実行しなければならない
- **FR-006**: 各チェックの結果（成功/失敗、エラー詳細）はGitHubのプルリクエストページで確認できなければならない
- **FR-007**: チェック失敗時は、失敗したステップとエラー内容が明確に識別できなければならない
- **FR-008**: ワークフローは依存パッケージを正しくインストールした上でチェックを実行しなければならない
- **FR-009**: 各チェック（ruff、mypy、pytest）は並列で実行され、1つが失敗しても他のチェックは継続して完了しなければならない

### Key Entities

- **Workflow**: CI/CD処理を定義するもの。トリガー条件、実行ステップ、対象Pythonバージョンを含む
- **Check Result**: 個々のチェック（ruff、mypy、pytest）の実行結果。成功/失敗状態とエラー詳細を含む

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: プルリクエスト作成から全チェック完了まで10分以内で完了する
- **SC-002**: チェック結果がプルリクエストページにリアルタイムで反映される
- **SC-003**: Python 3.11でテストが実行される
- **SC-004**: CI失敗時、エラーの原因特定に必要な情報が表示される（エラーメッセージ、失敗したファイル/行番号）
- **SC-005**: 既存のローカルチェック（ruff check .、mypy、pytest）と同等の検証がCI上で実行される

## Assumptions

- GitHub Actionsの無料枠（パブリックリポジトリ）または有料プラン（プライベートリポジトリ）が利用可能
- リポジトリにはすでにpyproject.tomlが存在し、開発依存パッケージが定義されている
- ブランチ保護ルールの設定はリポジトリ管理者が別途GitHubの設定画面で行う（User Story 3）
