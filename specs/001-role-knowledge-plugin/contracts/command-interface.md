# Command Interface Contract: /add-role-knowledge

**Feature**: 001-role-knowledge-plugin
**Date**: 2025-11-29

## Command Definition

### Frontmatter

```yaml
---
name: add-role-knowledge
description: 職能（ロール）ごとの知見をClaude Codeプラグインとして追加・更新する
---
```

### Invocation

```
/context-forge.add-role-knowledge [ロール名または説明]
```

---

## Interactive Flow

### Phase 1: Role Selection

```
┌─────────────────────────────────────────────────────────────┐
│ /add-role-knowledge を実行                                  │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
            ┌───────────────────────────────┐
            │ 既存ロールプラグインを検索     │
            │ (.claude/plugins/ をスキャン) │
            └───────────────────────────────┘
                            │
              ┌─────────────┴─────────────┐
              ▼                           ▼
    ┌─────────────────┐         ┌─────────────────┐
    │ 既存ロールあり   │         │ 既存ロールなし   │
    │ → 選択肢を表示  │         │ → 新規作成へ    │
    └─────────────────┘         └─────────────────┘
```

**Prompt (既存ロールあり)**:
```markdown
## ロールの選択

以下の既存ロールが見つかりました:

| # | ロール名 | 説明 | 知見数 |
|---|----------|------|--------|
| 1 | frontend-engineer | フロントエンド開発の知見 | 3 |
| 2 | backend-engineer | バックエンド開発の知見 | 5 |

選択肢:
- 番号を入力: 既存ロールに知見を追加
- "new": 新規ロールを作成
- "cancel": キャンセル
```

---

### Phase 2: Role Definition (新規の場合)

**Prompt**:
```markdown
## 新規ロールの作成

### ロール名
ロールの識別名を入力してください（例: frontend-engineer, devops-lead）

Format: 小文字英数字とハイフンのみ (最大64文字)
```

**Prompt (続き)**:
```markdown
### ロールの説明
このロールの役割と専門領域を簡潔に説明してください。

例: "フロントエンド開発のベストプラクティスとReact/TypeScriptの知見を持つ"
```

---

### Phase 3: Knowledge Input

**Prompt**:
```markdown
## 知見の追加

追加したい知見やスキルを説明してください。

例:
- "コードレビューで確認すべきチェックリスト"
- "設計ドキュメントを自動生成する"
- "セキュリティ観点でコードを自律的にレビューする"
- "コミット前にリンターを実行してチェックする"

複数の知見を追加する場合は、1つずつ処理します。
```

---

### Phase 4: Type Detection & Confirmation

**Prompt**:
```markdown
## 知見タイプの判定

入力: "コードレビューで確認すべきチェックリスト"

**推奨タイプ**: Skill
**理由**: 参照情報やチェックリストはSkillとして実装するのが最適です。
         Claudeが必要なときに自動的に参照できます。

| タイプ | 説明 | この知見に適している理由 |
|--------|------|------------------------|
| A: Skill | 参照情報として自動活用 | チェックリストは参照情報として最適 |
| B: Command | スラッシュコマンドで実行 | 明示的な呼び出しが必要な場合 |
| C: Sub Agent | 自律的なタスク遂行 | 分析や判断が必要な場合 |
| D: Hook | イベント駆動で自動実行 | 特定タイミングで実行する場合 |

推奨を採用する場合は "yes"、変更する場合はA-Dを入力してください。
```

---

### Phase 5: Content Generation

**Internal Process**:
1. 公式ドキュメントをフェッチ（失敗時はキャッシュ使用 + 警告表示）
2. 選択されたタイプに応じたテンプレートを生成
3. ユーザー入力を組み込んでファイルを作成

**Output (Skill の場合)**:
```markdown
## 生成されたファイル

`.claude/plugins/frontend-engineer/skills/code-review-checklist/SKILL.md`:

\`\`\`markdown
---
name: code-review-checklist
description: フロントエンドコードレビューで確認すべきチェックリスト。
             コードレビュー、PRレビュー時に参照。
---

## コードレビューチェックリスト

### パフォーマンス
- [ ] 不要な再レンダリングを防いでいるか
- [ ] メモ化が適切に使用されているか
...
\`\`\`
```

---

### Phase 6: Continuation

**Prompt**:
```markdown
## 知見を追加しました

作成したファイル:
- .claude/plugins/frontend-engineer/skills/code-review-checklist/SKILL.md

次のアクション:
- "add": さらに知見を追加
- "done": 完了してプラグインを確定
- "cancel": 変更を破棄
```

---

### Phase 7: Finalization

**Output**:
```markdown
## プラグイン生成完了

### 作成されたプラグイン

**ロール**: frontend-engineer
**場所**: .claude/plugins/frontend-engineer/

**構成**:
├── .claude-plugin/
│   └── plugin.json
├── skills/
│   └── code-review-checklist/
│       └── SKILL.md
└── agents/
    └── architecture-reviewer.md

### 次のステップ

1. Claude Codeを再起動またはプラグインをリロード
2. プラグインが認識されると、追加した知見が自動的に利用可能になります
3. Skillは関連するタスクで自動参照されます
4. Commandは `/frontend-engineer.{command-name}` で実行できます
```

---

## Error Handling

| Error | Response |
|-------|----------|
| ロール名が無効 | 形式エラーを表示し再入力を促す |
| 既存プラグインと競合 | 更新フローへ誘導 |
| ドキュメント取得失敗 | 警告表示 + キャッシュ使用で続行 |
| ファイル書き込み失敗 | エラー表示 + 権限確認ヒント |
| キャンセル | 作成中のファイルを削除して終了 |

---

## Generated Artifacts

### plugin.json

```json
{
  "name": "{role-name}",
  "description": "{role-description}",
  "version": "1.0.0",
  "author": {
    "name": "Generated by context-forge"
  }
}
```

### File Naming Convention

| Type | Location | Naming |
|------|----------|--------|
| Skill | `skills/{name}/SKILL.md` | ケバブケース |
| Command | `commands/{name}.md` | ケバブケース |
| Sub Agent | `agents/{name}.md` | ケバブケース |
| Hook | `hooks/hooks.json` | 固定名 |
