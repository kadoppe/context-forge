# Quickstart: SubAgent品質向上のためのプロンプト改善

**Date**: 2025-11-30
**Feature**: 001-improve-subagent-quality

## 概要

この機能は `add-role-knowledge` コマンドのプロンプトを改善し、生成されるSubAgentの品質を向上させます。

## 変更対象

```
src/context_forge_cli/templates/commands/add-role-knowledge.md
```

**注意**: このファイルは `context-forge init` コマンドでプロジェクトにインストールされるテンプレートのソースです。改善することで、新規プロジェクトへのインストール時に品質改善されたコマンドが自動的に適用されます。

## 実装手順

### Step 1: SubAgentテンプレートの拡充

`Phase 5: ファイル生成` セクション内の `Sub Agent ファイルテンプレート` を以下のように拡充：

1. 必須セクション構造を追加
2. ベストプラクティスのガイドラインを埋め込み
3. トラブルシューティングと注意事項のテンプレートを追加

### Step 2: 品質チェックPhaseの追加

`Phase 5` と `Phase 6` の間に新しいPhaseを追加：

```markdown
## Phase 5.5: 品質チェック

生成したSubAgentファイルに対して以下のチェックを実行してください：

### チェック項目

| # | 項目 | 自動修正 |
|---|------|---------|
| 1 | プレースホルダー構文がないか | Yes |
| 2 | 変数が適切にクォートされているか | Yes |
| 3 | 危険なgit操作がないか | Yes |
| 4 | 必須セクションがあるか | Yes |

### 実行手順

1. 生成したファイルを読み込む
2. 各チェック項目を検証
3. 問題があれば自動修正
4. 自動修正できない場合は警告を表示
```

### Step 3: テンプレート内容の更新

`Sub Agent ファイルテンプレート` を以下の構造に更新：

```markdown
---
name: {knowledge-name}
description: {description}
tools: Bash, Read, Write, Edit, Grep, Glob
model: sonnet
---

# {Title}

{概要説明}

## 実行手順

### 1. {ステップ1}

{説明}

\`\`\`bash
# 良い例: 変数をキャッシュして再利用
VAR=$(command --json field -q '.value')
other_command "$VAR"
\`\`\`

## トラブルシューティング

### {問題1}

{対処法}

## 注意事項

- 修正を行う前に、必ずユーザーに確認を取ること
- `git add -A` は使用禁止 - 必ず修正ファイルを個別に指定すること
- プッシュ前に `git diff --staged` で変更内容を確認すること
```

## 検証方法

1. 改善後のコマンドでSubAgentを生成
2. 生成されたファイルが品質ガイドラインを満たしているか確認
3. PRを作成してレビュー指摘件数を計測

## 成功基準

- プレースホルダー構文が残っていない
- 必須セクション（トラブルシューティング、注意事項）が含まれている
- bashコマンドが安全パターンに従っている
- git操作が安全パターンに従っている
